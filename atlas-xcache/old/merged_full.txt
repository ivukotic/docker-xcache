set rootdir=$XC_ROOTDIR

if defined ?~XC_RESOURCENAME
 set eSITE=$XC_RESOURCENAME
 all.sitename $eSITE
fi

ofs.osslib  libXrdPss.so
pss.cachelib libXrdPfc.so

pss.origin =

# Load the Rucio namespace-mapping plugin
pss.namelib -lfncache /usr/lib64/XrdName2NameDCP4RUCIO.so


# Set default values for the cache plugin
set eSPACELOWWM=0.90
set eSPACEHIGHWM=0.95
set eWQBLOCKS=10
set eWQTHREADS=2
set eRAMSIZE=16g
set eBLOCKSIZE=1M
set ePREFETCH=0

if defined ?~XC_BLOCKSIZE
   set eBLOCKSIZE=$XC_BLOCKSIZE
fi

if defined ?~XC_PREFETCH
   set ePREFETCH=$XC_PREFETCH
fi

if defined ?~XC_RAMSIZE
   set eRAMSIZE=$XC_RAMSIZE
fi

if defined ?~XC_SPACE_LOW_WM
   set eSPACELOWWM=$XC_SPACE_LOW_WM
fi

if defined ?~XC_SPACE_HIGH_WM
   set eSPACEHIGHWM=$XC_SPACE_HIGH_WM
fi

if defined ?~XC_WQ_BLOCKS_PER_LOOP
   set eWQBLOCKS=$XC_WQ_BLOCKS_PER_LOOP
fi

if defined ?~XC_WQ_THREADS
   set eWQTHREADS=$XC_WQ_THREADS
fi

pfc.blocksize $eBLOCKSIZE
pfc.ram $eRAMSIZE
pfc.prefetch $ePREFETCH
pfc.diskusage $eSPACELOWWM $eSPACEHIGHWM
pfc.writequeue $eWQBLOCKS $eWQTHREADS

all.export /atlas/rucio
all.export /root:/
all.export /xroot:/

xrd.protocol http:7777 libXrdHttp.so
all.export  /http:/
all.export  /https:/

all.adminpath /var/spool/xrootd
all.pidpath /run/xrootd

oss.localroot $(rootdir)

# Standard logging
xrootd.trace emsg login stall redirect
pfc.trace info

# Enable some debugging from the embedded client in the proxy server. For more debugging change to 3
pss.setopt DebugLevel 1


setenv X509_USER_PROXY = /etc/proxy/x509up

# placement of cinfo files is normally set in runme.sh
set eMETA=$XC_META
oss.localroot  $eMETA/namespace
oss.space meta $eMETA/xrdcinfos

oss.space data /xcache/data*
pfc.spaces data meta

set eMONITOR=$XC_MONITOR
xrootd.monitor ident off dest pfc 127.0.0.1:9000
# xrootd.monitor flush 10s ident 300s dest pfc 127.0.0.1:9000
xrootd.mongstream pfc use flush 30s maxlen 1500 send json insthdr noident 127.0.0.1:9000

